<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Заказ завтраков | ARTSTUDIO Nevsky</title>

  <style>
    /* Подключение шрифта Circe */
@font-face {
  font-family: 'Circe';
  src: url('./fonts/circe-light.woff2') format('woff2'),
       url('./fonts/circe-light.woff') format('woff');
  font-weight: 300;
  font-style: normal;
}

@font-face {
  font-family: 'Circe';
  src: url('./fonts/circe.woff2') format('woff2'),
       url('./fonts/circe.woff') format('woff');
  font-weight: 400;
  font-style: normal;
}

@font-face {
  font-family: 'Circe';
  src: url('./fonts/circe-bold.woff2') format('woff2'),
       url('./fonts/circe-bold.woff') format('woff');
  font-weight: 700;
  font-style: normal;
}

    /* Базовые стили */
body {
  margin: 0;
  padding: 0;
  font-family: 'Circe', sans-serif;
  background-color: #ffffff;
  color: #262d36;
}

    header img {
      max-width: 200px;
      margin-bottom: 1rem;
    }
    h1 {
      font-size: 2rem;
      font-weight: 400;
      text-align: center;
      margin: 0;
    }
    main {
      max-width: 600px;
      margin: 2rem auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .form-section {
      margin-bottom: 2rem;
    }
    .form-section h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    button, select, input[type="text"], textarea {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      font-family: 'Circe', sans-serif;
      font-size: 1rem;
    }
    button {
      background-color: #c49a5f;
      color: white;
      font-weight: 700;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #a47f48;
    }
    .language-toggle {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      margin-bottom: 2rem;
    }
    .language-toggle button {
      width: auto;
      padding: 0.5rem 1rem;
    }
    @media (max-width: 600px) {
      body {
        padding: 1rem;
        background-size: cover;
      }
      main {
        padding: 1.5rem;
        margin: 1rem auto;
        box-shadow: none;
      }
      header img {
        max-width: 150px;
      }
      h1 {
        font-size: 1.5rem;
      }
      .form-section h2 {
        font-size: 1.25rem;
      }
      button, select, input[type="text"], textarea {
        font-size: 1rem;
        padding: 0.5rem;
      }
      .language-toggle {
        gap: 0.5rem;
        margin-top: 1rem;
      }
      .language-toggle button {
        width: 100%;
      }
    }
    .breakfast-description {
      margin-top: 0.5rem;
      font-size: 0.95rem;
      color: #555;
    }

    /* Стилизация SELECT */
    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      padding: 0.75rem;
      font-family: 'Circe', sans-serif;
      font-size: 1rem;
      color: #262d36;
      background-image: url('data:image/svg+xml,%3Csvg viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg"%3E%3Cpolygon points="70,100 15,40 125,40" fill="%23666"%3E%3C/polygon%3E%3C/svg%3E');
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 0.65rem auto;
    }

    select:focus {
      outline: none;
      border-color: #c49a5f;
      box-shadow: 0 0 0 3px rgba(196, 154, 95, 0.3);
    }
    header {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: #ffffff;
  padding: 2rem 1rem;
  margin-bottom: 2rem;
  justify-content: center;
}

.rbi-logo-container {
  position: absolute;
  top: 1rem;
  right: 1rem;
}

.rbi-logo {
  width: 70px;
  opacity: 0.5;
  filter: grayscale(100%);
}

.main-logo img {
  background-color: transparent;
  max-width: 360px;
  margin-bottom: 2rem;
}

/* Для мобильных */
@media (max-width: 600px) {
  .main-logo img {
      background-color: transparent;
    max-width: 200px;
  }
}

.language-toggle {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
  margin-bottom: 3rem; /* Увеличенный отступ после языков */
}

.language-toggle button {
  padding: 0.75rem 1.5rem;
  border: 1px solid #c49a5f;
  background-color: #ffffff;
  color: #c49a5f;
  font-weight: 600;
  font-size: 1rem;
  border-radius: 9999px;
  cursor: pointer;
  transition: all 0.3s ease;
}

/* При наведении */
.language-toggle button:hover {
  background-color: #c49a5f;
  color: #ffffff;
}

h1#form-title {
  font-size: 2rem;
  font-weight: 400;
  text-align: center;
  margin-top: 1rem;
  color: #262d36;
}
    #modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(38, 45, 54, 0.5); /* полупрозрачный фон */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

#modal-window {
  background: #ffffff;
  padding: 2rem;
  border-radius: 1.5rem;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  text-align: center;
  max-width: 90%;
  font-family: 'Circe', sans-serif;
  animation: modalFadeIn 0.3s ease-out;
}

#modal-window p {
  font-size: 1.1rem;
  color: #262d36;
  margin-bottom: 1.5rem;
}

#modal-ok-button {
  padding: 0.75rem 2rem;
  background-color: #c49a5f;
  color: #ffffff;
  border: none;
  border-radius: 2rem;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
  font-family: 'Circe', sans-serif;
}

#modal-ok-button:hover {
  background-color: #a47f48;
}

@keyframes modalFadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}
.intro-section {
  max-width: 600px;
  margin: 2rem auto;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 1rem;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  font-family: 'Circe', sans-serif;
  font-size: 1rem;
  line-height: 1.5;
  color: #262d36;
}

.intro-text p {
  margin: 0 0 1rem 0;
}

.intro-text ul {
  list-style: none;
  padding: 0;
  margin: 0 0 1rem 0;
}

.intro-text ul li {
  position: relative;
  padding-left: 1.5rem;
  margin-bottom: 0.5rem;
}

.intro-text ul li:before {
  content: '•';
  position: absolute;
  left: 0;
  color: #c49a5f;
  font-size: 1.2rem;
}

.intro-text strong {
  color: #262d36;
  font-weight: 700;
}

@media (max-width: 600px) {
  .intro-section {
    margin: 1rem auto;
    padding: 1rem;
    font-size: 0.95rem;
  }

  .intro-text p {
    margin: 0 0 0.75rem 0;
  }

  .intro-text ul li {
    padding-left: 1.2rem;
    margin-bottom: 0.4rem;
  }
}
    #name-section {
  margin-bottom: 2rem;
}

#name-section h2 {
  font-size: 1.5rem;
  font-weight: 400;
  margin-bottom: 0.5rem;
}

#name-section input {
  width: 100%;
  padding: 0.75rem;
  margin-top: 0.5rem;
  border: 1px solid #ccc;
  border-radius: 0.5rem;
  font-family: 'Circe', sans-serif;
  font-size: 1rem;
  box-sizing: border-box;
}

#name-section input:focus {
  outline: none;
  border-color: #c49a5f;
  box-shadow: 0 0 5px rgba(196, 154, 95, 0.3);
}

@media (max-width: 600px) {
  #name-section {
    margin-bottom: 1.5rem;
  }

  #name-section h2 {
    font-size: 1.25rem;
    margin-bottom: 0.4rem;
  }

  #name-section input {
    padding: 0.5rem;
    font-size: 0.9rem;
  }
}
  </style>
</head>

<body>

<header>
  <div class="rbi-logo-container">
    <img src="RBI%20PM%20лого.png" alt="Логотип RBI PM" class="rbi-logo">
  </div>

  <div class="main-logo">
    <img src="ARTSTUDIO%20Nevsky%20лого.png" alt="Логотип ARTSTUDIO Nevsky">
  </div>

  <div class="language-toggle">
    <button id="ru-btn">Русский</button>
    <button id="en-btn">English</button>
  </div>

  <h1 id="form-title">Заказ завтраков</h1>
</header>
<section class="intro-section">
  <div id="intro-ru" class="intro-text">
    <p><strong>Каждое утро с 9:30 до 11:30</strong> мы приглашаем вас на завтрак в ресторан Memet&PIR.<br>
    Он находится рядом: выйдите из здания на 2-ю Советскую улицу через основной ресепшен, поверните налево — следующая дверь будет входом в ресторан.</p>
    <p><strong>Вы можете выбрать формат подачи:</strong></p>
    <ul>
      <li><strong>В ресторане</strong> — завтрак подаётся по выбранному времени в зале ресторана;</li>
      <li><strong>Ланчбокс</strong> — завтрак, собранный для вас заранее и готовый к выдаче вечером на ресепшене (при заказе до 20:00).</li>
    </ul>
    <p><strong>Турецкий завтрак</strong> доступен только в ресторане.</p>
    <p>Заполните короткую форму ниже: укажите номер апартамента, дату, формат подачи и пожелания к завтраку.<br>
    Если появятся вопросы — всегда рады помочь на ресепшене!</p>
  </div>
  <div id="intro-en" class="intro-text" style="display: none;">
    <p><strong>Every morning from 9:30 AM to 11:30 AM</strong>, we invite you to breakfast at Memet&PIR restaurant.<br>
    It’s just around the corner: exit through the main reception onto 2nd Sovetskaya Street, turn left, and you’ll find the entrance to the restaurant right next door.</p>
    <p><strong>You can choose your preferred serving format:</strong></p>
    <ul>
      <li><strong>At the restaurant</strong> — breakfast will be served at your selected time;</li>
      <li><strong>Lunchbox</strong> — a takeaway breakfast prepared for you in advance, available for pickup at the reception desk in the evening (please order by 8:00 PM).</li>
    </ul>
    <p><strong>Please note:</strong> Turkish breakfast is available only at the restaurant.</p>
    <p>Fill out the short form below: indicate your apartment number, serving format, date, and breakfast preferences.<br>
    If you have any questions, feel free to contact the reception — we’re always happy to help!</p>
  </div>
</section>
  <main>
    <form id="breakfast-form">
      <div class="form-section" id="name-section">
      <h2 id="first-name-title">Имя</h2>
      <input type="text" id="first-name" name="first-name" placeholder="Введите имя" required>
      <h2 id="last-name-title">Фамилия</h2>
      <input type="text" id="last-name" name="last-name" placeholder="Введите фамилию" required>
    </div>
      <div class="form-section" id="apartment-section">
        <h2 id="apartment-title">Номер апартамента</h2>
        <input type="text" id="apartment-number" name="apartment-number" placeholder="Введите номер апартамента" required>
      </div>

      <div class="form-section" id="format-section">
        <h2 id="format-title">Формат подачи</h2>
        <select id="format-select" name="format-select" required>
          <option value="">Выберите формат подачи</option>
          <option value="restaurant">В ресторане</option>
          <option value="lunchbox">Ланчбокс</option>
        </select>
        <p id="format-info" style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;"></p>
      </div>

      <div class="form-section" id="date-section" style="display: none;">
        <h2 id="date-title">Дата подачи</h2>
        <select id="date-select" name="date-select" required>
          <option value="">Выберите дату подачи</option>
          <option value="today">Сегодня</option>
          <option value="tomorrow">Завтра</option>
        </select>
      </div>

      <div class="form-section" id="time-section" style="display: none;">
        <h2 id="time-title">Время подачи</h2>
        <select id="time-select" name="time-select" required></select>
      </div>

      <div class="form-section" id="guests-section">
        <h2 id="guests-title">Количество гостей</h2>
        <select id="guests-count" name="guests-count" required>
          <option value="">Выберите количество гостей</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </div>

      <div id="guests-details"></div>

      <div class="form-section" id="comments-section">
        <h2 id="comments-title">Комментарии к заказу</h2>
        <textarea id="comments" name="comments" placeholder="Если есть пожелания или особенности — укажите здесь" rows="4" style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; border: 1px solid #ccc; border-radius: 0.5rem; font-family: 'Circe', sans-serif; font-size: 1rem;"></textarea>
      </div>

      <div class="form-section" id="submit-section">
        <button type="submit" id="submit-button">Подтвердить заказ</button>
      </div>

    </form>
  </main>
  <div id="modal-overlay" style="display: none;">
  <div id="modal-window">
    <p id="modal-message"></p>
    <button id="modal-ok-button">Ок</button>
  </div>
</div>
<script>

function showModal(message, callback) {
  const overlay = document.getElementById('modal-overlay');
  const modalWindow = document.getElementById('modal-window');
  const modalMessage = document.getElementById('modal-message');
  const modalOkButton = document.getElementById('modal-ok-button');

  // Очищаем возможные дополнительные кнопки
  const extraButtons = modalWindow.querySelector('.modal-extra-buttons');
  if (extraButtons) extraButtons.remove();

  modalMessage.innerHTML = message; // Изменено на innerHTML
  overlay.style.display = 'flex';
  modalOkButton.style.display = 'inline-block';

  modalOkButton.onclick = () => {
    overlay.style.display = 'none';
    if (callback) callback();
  };
}

function showConfirmModal(message, onConfirm, onCancel) {
  const overlay = document.getElementById('modal-overlay');
  const modalWindow = document.getElementById('modal-window');
  const modalMessage = document.getElementById('modal-message');
  const modalOkButton = document.getElementById('modal-ok-button');

  // Убираем кнопку "Ок"
  modalOkButton.style.display = 'none';

  // Удаляем старые дополнительные кнопки (если они есть)
  const oldExtraButtons = modalWindow.querySelector('.modal-extra-buttons');
  if (oldExtraButtons) oldExtraButtons.remove();

  const confirmButtons = document.createElement('div');
  confirmButtons.className = 'modal-extra-buttons';
  confirmButtons.style.display = 'flex';
  confirmButtons.style.justifyContent = 'center';
  confirmButtons.style.gap = '1rem';
  confirmButtons.style.marginTop = '1.5rem';

  const yesButton = document.createElement('button');
  yesButton.textContent = currentLanguage === 'ru' ? 'Да' : 'Yes';
  yesButton.style.padding = '0.75rem 2rem';
  yesButton.style.backgroundColor = '#c49a5f';
  yesButton.style.color = '#ffffff';
  yesButton.style.border = 'none';
  yesButton.style.borderRadius = '2rem';
  yesButton.style.fontWeight = '600';
  yesButton.style.fontSize = '1rem';
  yesButton.style.cursor = 'pointer';

  const noButton = document.createElement('button');
  noButton.textContent = currentLanguage === 'ru' ? 'Нет' : 'No';
  noButton.style.padding = '0.75rem 2rem';
  noButton.style.backgroundColor = '#ccc';
  noButton.style.color = '#262d36';
  noButton.style.border = 'none';
  noButton.style.borderRadius = '2rem';
  noButton.style.fontWeight = '600';
  noButton.style.fontSize = '1rem';
  noButton.style.cursor = 'pointer';

  confirmButtons.appendChild(yesButton);
  confirmButtons.appendChild(noButton);

  modalMessage.innerHTML = message; // Изменено на innerHTML
  modalWindow.appendChild(confirmButtons);
  overlay.style.display = 'flex';

  yesButton.onclick = () => {
    overlay.style.display = 'none';
    confirmButtons.remove();
    modalOkButton.style.display = 'inline-block';
    if (onConfirm) onConfirm();
  };

  noButton.onclick = () => {
    overlay.style.display = 'none';
    confirmButtons.remove();
    modalOkButton.style.display = 'inline-block';
    if (onCancel) onCancel();
  };
}


  
let currentLanguage = 'ru';

const firstNameInput = document.getElementById('first-name');
const lastNameInput = document.getElementById('last-name');
const firstNameTitle = document.getElementById('first-name-title');
const lastNameTitle = document.getElementById('last-name-title');
const introRu = document.getElementById('intro-ru');
const introEn = document.getElementById('intro-en');
const ruBtn = document.getElementById('ru-btn');
const enBtn = document.getElementById('en-btn');
const formTitle = document.getElementById('form-title');
const apartmentTitle = document.getElementById('apartment-title');
const apartmentNumber = document.getElementById('apartment-number');
const formatSelectEl = document.getElementById('format-select');
const formatInfoEl = document.getElementById('format-info');
const timeSection = document.getElementById('time-section');
const timeSelect = document.getElementById('time-select');
const guestsCount = document.getElementById('guests-count');
const guestsDetails = document.getElementById('guests-details');
const commentsTitle = document.getElementById('comments-title');
const commentsField = document.getElementById('comments');
const submitButton = document.getElementById('submit-button');
const dateSection = document.getElementById('date-section');
const dateSelect = document.getElementById('date-select');

const breakfastOptions = [
  { value: 'hearty', ru: 'Сытный завтрак – 850₽', en: 'Hearty breakfast – 850₽' },
  { value: 'sweet', ru: 'Сладкий завтрак – 850₽', en: 'Sweet breakfast – 850₽' },
  { value: 'assorted', ru: 'Ассорти завтрак – 1100₽', en: 'Assorted breakfast – 1100₽' },
  { value: 'turkish', ru: 'Турецкий завтрак – 1800₽ (только ресторан)', en: 'Turkish breakfast – 1800₽ (restaurant only)' },
];
dateSelect.addEventListener('change', () => {
  const now = new Date();
  const utcHours = now.getUTCHours();
  const moscowHours = (utcHours + 3) % 24;
  const moscowMinutes = now.getUTCMinutes();
  const currentTime = moscowHours * 60 + moscowMinutes;
  const restaurantCutoffTime = 11 * 60 + 30; // 11:30 по Москве

  if (formatSelectEl.value === 'restaurant' && dateSelect.value === 'today' && currentTime > restaurantCutoffTime) {
    showModal(
      currentLanguage === 'ru'
        ? 'Заказ в ресторане после 11:30 доступен только на завтра. Пожалуйста, выберите другую дату.'
        : 'Restaurant orders after 11:30 are available only for tomorrow. Please select another date.',
      () => {
        dateSelect.value = 'tomorrow';
      }
    );
  }
});
const breakfastDescriptions = {
  hearty: {
    ru: "Глазунья с сосисками, сыр, овощная нарезка, каша и напиток на выбор",
    en: "Fried eggs with sausages, cheese, vegetable platter, porridge and a drink of choice"
  },
  sweet: {
    ru: "Блинчики, сырники, сметана, сгущенка, варенье, каша и напиток на выбор",
    en: "Pancakes, cheesecakes, sour cream, condensed milk, jam, porridge and a drink of choice"
  },
  assorted: {
    ru: "Глазунья с сосисками, блинчик, сырник, сметана, сгущенка, варенье, сыр, овощная нарезка, каша и напиток на выбор",
    en: "Fried eggs with sausages, pancake, cheesecake, sour cream, condensed milk, jam, cheese, vegetable platter, porridge and a drink of choice"
  },
  turkish: {
    ru: "Овощная тарелка, сливки, два вида сыра, пирог, яйцо, картофель фри, оливки, мед, лепешка, чайник турецкого чая",
    en: "Vegetable plate, cream, two types of cheese, pie, egg, french fries, olives, honey, flatbread, Turkish tea pot"
  }
};

const porridges = [
  { value: 'none', ru: 'Без каши', en: 'No porridge' },
  { value: 'oatmeal', ru: 'Овсяная каша', en: 'Oatmeal' },
  { value: 'rice', ru: 'Рисовая каша', en: 'Rice porridge' },
];

const drinks = [
  { value: 'black_tea', ru: 'Чай черный', en: 'Black tea' },
  { value: 'green_tea', ru: 'Чай зеленый', en: 'Green tea' },
  { value: 'americano', ru: 'Американо', en: 'Americano' },
  { value: 'espresso', ru: 'Эспрессо', en: 'Espresso' },
  { value: 'apple_juice', ru: 'Яблочный сок', en: 'Apple juice' },
  { value: 'orange_juice', ru: 'Апельсиновый сок', en: 'Orange juice' },
];

const turkishDishes = [
  { value: 'turkish_omelette', ru: 'Турецкий омлет', en: 'Turkish omelette' },
  { value: 'fried_eggs', ru: 'Яичница с колбасой', en: 'Fried eggs with sausage' },
];

const extras = [
  { value: 'croissant', ru: 'Круассан – 100₽', en: 'Croissant – 100₽' },
  { value: 'yogurt', ru: 'Домашний йогурт – 300₽', en: 'Homemade yogurt – 300₽' },
  { value: 'salmon', ru: 'Лосось – 250₽', en: 'Salmon – 250₽' },
  { value: 'alt_milk', ru: 'Альтернативное молоко (кокосовое) – 150₽', en: 'Alternative milk (coconut) – 150₽' },
];
const translations = {
  ru: {
    formTitle: 'Заказ завтраков',
    firstNameTitle: 'Имя', // Добавлено
    firstNamePlaceholder: 'Введите имя', // Добавлено
    lastNameTitle: 'Фамилия', // Добавлено
    lastNamePlaceholder: 'Введите фамилию', // Добавлено
    apartmentTitle: 'Номер апартамента',
    apartmentPlaceholder: 'Введите номер апартамента',
    formatTitle: 'Формат подачи',
    formatPlaceholder: 'Выберите формат подачи',
    formatRestaurant: 'В ресторане',
    formatLunchbox: 'Ланчбокс',
    dateTitle: 'Дата подачи', // Добавлено
    datePlaceholder: 'Выберите дату подачи', // Добавлено
    dateToday: 'Сегодня', // Добавлено
    dateTomorrow: 'Завтра', // Добавлено
    timeTitle: 'Время подачи',
    guestsTitle: 'Количество гостей',
    guestsPlaceholder: 'Выберите количество гостей',
    commentsTitle: 'Комментарии к заказу',
    commentsPlaceholder: 'Если есть пожелания или особенности — укажите здесь',
    submitButton: 'Подтвердить заказ'
  },
  en: {
    formTitle: 'Breakfast Order',
    firstNameTitle: 'First Name', // Добавлено
    firstNamePlaceholder: 'Enter first name', // Добавлено
    lastNameTitle: 'Last Name', // Добавлено
    lastNamePlaceholder: 'Enter last name', // Добавлено
    apartmentTitle: 'Apartment Number',
    apartmentPlaceholder: 'Enter apartment number',
    formatTitle: 'Serving format',
    formatPlaceholder: 'Select serving format',
    formatRestaurant: 'At the restaurant',
    formatLunchbox: 'Lunchbox',
    dateTitle: 'Serving date', // Добавлено
    datePlaceholder: 'Select serving date', // Добавлено
    dateToday: 'Today', // Добавлено
    dateTomorrow: 'Tomorrow', // Добавлено
    timeTitle: 'Serving time',
    guestsTitle: 'Number of guests',
    guestsPlaceholder: 'Select number of guests',
    commentsTitle: 'Order comments',
    commentsPlaceholder: 'If you have any wishes or notes — specify here',
    submitButton: 'Confirm order'
  }
};

// Функция для форматирования даты в дд.мм.гггг
function formatDate(date) {
  const day = String(date.getDate()).padStart(2, '0');
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const year = date.getFullYear();
  return `${day}.${month}.${year}`;
}
  
// Обновление текстов при смене языка
function updateTexts() {
  const t = translations[currentLanguage];

  formTitle.textContent = t.formTitle;
  firstNameTitle.textContent = t.firstNameTitle; // Добавлено
  firstNameInput.placeholder = t.firstNamePlaceholder; // Добавлено
  lastNameTitle.textContent = t.lastNameTitle; // Добавлено
  lastNameInput.placeholder = t.lastNamePlaceholder; // Добавлено
  apartmentTitle.textContent = t.apartmentTitle;
  apartmentNumber.placeholder = t.apartmentPlaceholder;
  document.getElementById('format-title').textContent = t.formatTitle;
  document.getElementById('date-title').textContent = t.dateTitle; // Добавлено
  document.getElementById('time-title').textContent = t.timeTitle;
  document.getElementById('guests-title').textContent = t.guestsTitle;
  document.getElementById('comments-title').textContent = t.commentsTitle;

  // Обновление опций для формата подачи
  if (formatSelectEl.options.length >= 3) {
    formatSelectEl.options[0].textContent = t.formatPlaceholder;
    formatSelectEl.options[1].textContent = t.formatRestaurant;
    formatSelectEl.options[2].textContent = t.formatLunchbox;
  }

  // Обновление опций для даты подачи
  if (dateSelect.options.length >= 3) {
    dateSelect.options[0].textContent = t.datePlaceholder;
    dateSelect.options[1].textContent = t.dateToday;
    dateSelect.options[2].textContent = t.dateTomorrow;
  }

  if (guestsCount.options.length > 0) {
    guestsCount.options[0].textContent = t.guestsPlaceholder;
  }

  commentsField.placeholder = t.commentsPlaceholder;
  submitButton.textContent = t.submitButton;

  // Переключение вступительного текста
  if (currentLanguage === 'ru') {
    introRu.style.display = 'block';
    introEn.style.display = 'none';
  } else {
    introRu.style.display = 'none';
    introEn.style.display = 'block';
  }
  
  translateStaticTexts();

  if (guestsCount.value) {
    guestsCount.dispatchEvent(new Event('change'));
  }

  regenerateGuests();

  if (formatSelectEl.value) {
    formatSelectEl.dispatchEvent(new Event('change'));
    updateLunchboxAvailability();
  }
}


function translateStaticTexts() {
  const t = translations[currentLanguage];

  document.getElementById('format-title').textContent = t.formatTitle;
  document.getElementById('time-title').textContent = t.timeTitle;
  document.getElementById('guests-title').textContent = t.guestsTitle;
}
function regenerateGuests() {
  const guestBlocks = guestsDetails.querySelectorAll('.form-section');

  guestBlocks.forEach((block, index) => {
    // Заголовок гостя
    const guestTitle = block.querySelector(`#guest${index + 1}-title`);
    if (guestTitle) {
      guestTitle.textContent = currentLanguage === 'ru' ? `Гость ${index + 1}` : `Guest ${index + 1}`;
    }

    // Лейбл выбора завтрака
    const breakfastLabel = block.querySelector(`#breakfast${index + 1}-label`);
    if (breakfastLabel) {
      breakfastLabel.textContent = currentLanguage === 'ru' ? 'Выберите тип завтрака' : 'Select breakfast type';
    }

    // Селектор завтраков
    const breakfastSelect = block.querySelector(`select[name="guest${index + 1}-breakfast"]`);
    if (breakfastSelect) {
      const selectedValue = breakfastSelect.value;
      breakfastSelect.innerHTML = breakfastOptions.map(opt => 
        `<option value="${opt.value}" ${opt.value === selectedValue ? 'selected' : ''}>
          ${currentLanguage === 'ru' ? opt.ru : opt.en}
        </option>`
      ).join('');
    }

    // Описание завтрака
    const breakfastDesc = block.querySelector(`#breakfast-desc${index + 1}`);
    if (breakfastDesc && breakfastSelect) {
      const description = breakfastDescriptions[breakfastSelect.value];
      breakfastDesc.textContent = description
        ? (currentLanguage === 'ru' ? description.ru : description.en)
        : '';
    }

    // Дополнительные опции: каша, напиток, блюдо
    const extraOptions = block.querySelector(`#extra-options-${index + 1}`);
    if (extraOptions) {
      const selects = extraOptions.querySelectorAll('select');
      const labels = extraOptions.querySelectorAll('label');

      labels.forEach(label => {
        if (label.textContent.includes('кашу') || label.textContent.includes('porridge')) {
          label.textContent = currentLanguage === 'ru' ? 'Выберите кашу' : 'Select porridge';
        } else if (label.textContent.includes('напиток') || label.textContent.includes('drink')) {
          label.textContent = currentLanguage === 'ru' ? 'Выберите напиток' : 'Select drink';
        } else if (label.textContent.includes('блюдо') || label.textContent.includes('dish')) {
          label.textContent = currentLanguage === 'ru' ? 'Выберите блюдо' : 'Select dish';
        }
      });

      selects.forEach(select => {
        if (select.name.includes('porridge')) {
          const selectedValue = select.value;
          select.innerHTML = porridges.map(p => 
            `<option value="${p.value}" ${p.value === selectedValue ? 'selected' : ''}>
              ${currentLanguage === 'ru' ? p.ru : p.en}
            </option>`
          ).join('');
        }
        if (select.name.includes('drink')) {
          const selectedValue = select.value;
          select.innerHTML = drinks.map(d => 
            `<option value="${d.value}" ${d.value === selectedValue ? 'selected' : ''}>
              ${currentLanguage === 'ru' ? d.ru : d.en}
            </option>`
          ).join('');
        }
        if (select.name.includes('dish')) {
          const selectedValue = select.value;
          select.innerHTML = turkishDishes.map(d => 
            `<option value="${d.value}" ${d.value === selectedValue ? 'selected' : ''}>
              ${currentLanguage === 'ru' ? d.ru : d.en}
            </option>`
          ).join('');
        }
      });
    }

    // Дополнительно (checkboxes)
    const extrasSection = block.querySelector(`#extras-${index + 1}`);
    if (extrasSection) {
      extrasSection.innerHTML = '';
      const extrasTitle = document.createElement('label');
      extrasTitle.textContent = currentLanguage === 'ru' ? 'Дополнительно:' : 'Additionally:';
      extrasSection.appendChild(extrasTitle);

      extras.forEach(extra => {
        const checkboxLabel = document.createElement('label');
        checkboxLabel.style.display = 'block';
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.name = `guest${index + 1}-extras`;
        checkbox.value = extra.value;
        checkbox.checked = Array.from(block.querySelectorAll(`input[name="guest${index + 1}-extras"]`))
          .some(c => c.value === extra.value && c.checked);
        checkboxLabel.appendChild(checkbox);
        checkboxLabel.append(` ${currentLanguage === 'ru' ? extra.ru : extra.en}`);
        extrasSection.appendChild(checkboxLabel);
      });
    }
  });
  
}
window.addEventListener('load', () => {
  updateLunchboxAvailability();
});

// Кнопки переключения языка
ruBtn.addEventListener('click', () => {
  currentLanguage = 'ru';
  updateTexts();
});

enBtn.addEventListener('click', () => {
  currentLanguage = 'en';
  updateTexts();
});
// Генерация блоков гостей
guestsCount.addEventListener('change', () => {
  guestsDetails.innerHTML = '';
  const count = parseInt(guestsCount.value, 10);

  if (!isNaN(count)) {
    for (let i = 1; i <= count; i++) {
      const guestBlock = document.createElement('div');
      guestBlock.className = 'form-section';

      guestBlock.innerHTML = `
        <h3 id="guest${i}-title">${currentLanguage === 'ru' ? `Гость ${i}` : `Guest ${i}`}</h3>
        <label id="breakfast${i}-label" for="breakfast${i}">${currentLanguage === 'ru' ? 'Выберите тип завтрака' : 'Select breakfast type'}</label>
        <select id="breakfast${i}" name="guest${i}-breakfast" required>
          ${breakfastOptions.map(opt => `<option value="${opt.value}">${currentLanguage === 'ru' ? opt.ru : opt.en}</option>`).join('')}
        </select>
        <div id="breakfast-desc${i}" class="breakfast-description"></div>
        <div id="extra-options-${i}"></div>
        <div id="extras-${i}" class="extras-section"></div>
      `;

      guestsDetails.appendChild(guestBlock);
updateTurkishBreakfastAvailability();

      const breakfastSelect = document.getElementById(`breakfast${i}`);
      const breakfastDesc = document.getElementById(`breakfast-desc${i}`);
      const extraOptions = document.getElementById(`extra-options-${i}`);
      const extrasDiv = document.getElementById(`extras-${i}`);
      
function updateLunchboxAvailability() {
  const now = new Date();
  const utcHours = now.getUTCHours(); // Часы по UTC
  const moscowHours = (utcHours + 3) % 24; // Плюс 3 часа для Москвы
  const moscowMinutes = now.getUTCMinutes(); // Минуты те же

  const currentTime = moscowHours * 60 + moscowMinutes;
  const lunchboxCutoffTime = 20 * 60; // 20:00 по Москве = 1200 минут
  const restaurantCutoffTime = 11 * 60 + 30; // 11:30 по Москве = 690 минут

  const lunchboxOption = formatSelectEl.querySelector('option[value="lunchbox"]');
  const dateTodayOption = dateSelect.querySelector('option[value="today"]');
  const dateTomorrowOption = dateSelect.querySelector('option[value="tomorrow"]');

  // Проверка для ланчбокса
  if (lunchboxOption) {
    if (currentTime > lunchboxCutoffTime) {
      lunchboxOption.disabled = true;
      lunchboxOption.style.color = '#999';
      lunchboxOption.title = currentLanguage === 'ru'
        ? 'Ланчбокс заказывается до 20:00 по московскому времени. Пожалуйста, уточните на ресепшене.'
        : 'Lunchbox orders must be placed before 8 PM Moscow time. Please ask at the reception.';
      
      // Если "Ланчбокс" сейчас выбран — сбросить формат и очистить время
      if (formatSelectEl.value === 'lunchbox') {
        formatSelectEl.value = '';
        formatInfoEl.textContent = currentLanguage === 'ru'
          ? 'Выберите формат подачи'
          : 'Select serving format';
        timeSection.style.display = 'none';
        dateSection.style.display = 'none';
      }
    } else {
      lunchboxOption.disabled = false;
      lunchboxOption.style.color = '';
      lunchboxOption.title = '';
    }
  }

  // Проверка для ресторана после 11:30
  if (formatSelectEl.value === 'restaurant' && dateTodayOption && dateTomorrowOption) {
    if (currentTime > restaurantCutoffTime) {
      dateTodayOption.disabled = true;
      dateTodayOption.style.color = '#999';
      dateTodayOption.title = currentLanguage === 'ru'
        ? 'Заказ в ресторане после 11:30 доступен только на завтра.'
        : 'Restaurant orders after 11:30 are available only for tomorrow.';
      if (dateSelect.value === 'today') {
        dateSelect.value = 'tomorrow';
      }
    } else {
      dateTodayOption.disabled = false;
      dateTodayOption.style.color = '';
      dateTodayOption.title = '';
    }
  }
}



      function renderExtras() {
        extrasDiv.innerHTML = '';
        const extrasTitle = document.createElement('label');
        extrasTitle.textContent = currentLanguage === 'ru' ? 'Дополнительно:' : 'Additionally:';
        extrasDiv.appendChild(extrasTitle);

        extras.forEach(extra => {
          const checkboxLabel = document.createElement('label');
          checkboxLabel.style.display = 'block';
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.name = `guest${i}-extras`;
          checkbox.value = extra.value;
          checkboxLabel.appendChild(checkbox);
          checkboxLabel.append(` ${currentLanguage === 'ru' ? extra.ru : extra.en}`);
          extrasDiv.appendChild(checkboxLabel);
        });
      }

      breakfastSelect.addEventListener('change', () => {
        const description = breakfastDescriptions[breakfastSelect.value];
        breakfastDesc.textContent = description ? (currentLanguage === 'ru' ? description.ru : description.en) : '';

        extraOptions.innerHTML = '';

        if (['hearty', 'sweet', 'assorted'].includes(breakfastSelect.value)) {
          const porridgeLabel = document.createElement('label');
          porridgeLabel.textContent = currentLanguage === 'ru' ? 'Выберите кашу' : 'Select porridge';
          const porridgeSelect = document.createElement('select');
          porridgeSelect.name = `guest${i}-porridge`;
          porridges.forEach(porridge => {
            const option = document.createElement('option');
            option.value = porridge.value;
            option.textContent = currentLanguage === 'ru' ? porridge.ru : porridge.en;
            porridgeSelect.appendChild(option);
          });
          extraOptions.appendChild(porridgeLabel);
          extraOptions.appendChild(porridgeSelect);

          const drinkLabel = document.createElement('label');
          drinkLabel.textContent = currentLanguage === 'ru' ? 'Выберите напиток' : 'Select drink';
          const drinkSelect = document.createElement('select');
          drinkSelect.name = `guest${i}-drink`;
          drinks.forEach(drink => {
            const option = document.createElement('option');
            option.value = drink.value;
            option.textContent = currentLanguage === 'ru' ? drink.ru : drink.en;
            drinkSelect.appendChild(option);
          });
          extraOptions.appendChild(drinkLabel);
          extraOptions.appendChild(drinkSelect);
        }

        if (breakfastSelect.value === 'turkish') {
          const dishLabel = document.createElement('label');
          dishLabel.textContent = currentLanguage === 'ru' ? 'Выберите блюдо' : 'Select dish';
          const dishSelect = document.createElement('select');
          dishSelect.name = `guest${i}-dish`;
          turkishDishes.forEach(dish => {
            const option = document.createElement('option');
            option.value = dish.value;
            option.textContent = currentLanguage === 'ru' ? dish.ru : dish.en;
            dishSelect.appendChild(option);
          });
          extraOptions.appendChild(dishLabel);
          extraOptions.appendChild(dishSelect);

          const teaInfo = document.createElement('p');
          teaInfo.style.marginTop = '0.5rem';
          teaInfo.style.fontSize = '0.9rem';
          teaInfo.textContent = currentLanguage === 'ru'
            ? 'К турецкому завтраку автоматически включен чайник турецкого чая.'
            : 'A pot of Turkish tea is automatically included with the Turkish breakfast.';
          extraOptions.appendChild(teaInfo);
        }

        renderExtras();
      });

      breakfastSelect.dispatchEvent(new Event('change'));
updateTurkishBreakfastAvailability();

    }
  }
});
function updateTurkishBreakfastAvailability() {
  const breakfastSelects = guestsDetails.querySelectorAll('select[name^="guest"][name$="-breakfast"]');
  breakfastSelects.forEach(select => {
    const turkishOption = select.querySelector('option[value="turkish"]');
    if (turkishOption) {
      if (formatSelectEl.value === 'lunchbox') {
        turkishOption.disabled = true;
        turkishOption.style.color = '#999';
        turkishOption.title = currentLanguage === 'ru'
          ? 'Турецкий завтрак доступен только в ресторане'
          : 'Turkish breakfast is only available at the restaurant';
      } else {
        turkishOption.disabled = false;
        turkishOption.style.color = '';
        turkishOption.title = '';
      }
    }
  });
}
  // Обновление выбора даты по умолчанию
function updateDefaultDate() {
  const now = new Date();
  const utcHours = now.getUTCHours();
  const moscowHours = (utcHours + 3) % 24;
  const moscowMinutes = now.getUTCMinutes();
  const currentTime = moscowHours * 60 + moscowMinutes;
  const restaurantCutoffTime = 11 * 60 + 30; // 11:30 по Москве

  dateSelect.value = currentTime <= restaurantCutoffTime ? 'today' : 'tomorrow';
}
formatSelectEl.addEventListener('change', () => {
  const now = new Date();
  const utcHours = now.getUTCHours();
  const moscowHours = (utcHours + 3) % 24;
  const moscowMinutes = now.getUTCMinutes();
  const currentTime = moscowHours * 60 + moscowMinutes;
  const lunchboxCutoffTime = 20 * 60; // 20:00 по Москве
  const restaurantCutoffTime = 11 * 60 + 30; // 11:30 по Москве

  timeSelect.innerHTML = ''; // Очищаем старые опции

  dateSection.style.display = formatSelectEl.value ? 'block' : 'none';

  // Установка даты по умолчанию в зависимости от времени
  if (currentTime <= restaurantCutoffTime) {
    dateSelect.value = 'today'; // До 11:30 — "Сегодня"
  } else {
    dateSelect.value = 'tomorrow'; // После 11:30 — "Завтра"
  }

  // Проверка на ланчбокс поздно вечером
  if (formatSelectEl.value === 'lunchbox' && currentTime > lunchboxCutoffTime) {
    showModal(
      currentLanguage === 'ru'
        ? 'Ланчбокс можно заказать только до 20:00 по московскому времени. Подача будет организована в ресторане.'
        : 'Lunchbox orders are only available until 8 PM Moscow time. Serving will be arranged at the restaurant.',
      () => {
        formatSelectEl.value = 'restaurant';
        formatSelectEl.dispatchEvent(new Event('change'));
      }
    );
    return;
  }

  // Проверка на ланчбокс с 00:00 до 11:30
  if (formatSelectEl.value === 'lunchbox' && currentTime <= restaurantCutoffTime) {
    showConfirmModal(
      currentLanguage === 'ru'
        ? 'Ланчбокс готовят с вечера. Если на следующий день вам нужно позавтракать раньше, чем открывается ресторан, подача будет сегодня с 20:00. Вы уверены?'
        : 'Lunchboxes are prepared in the evening. If you need breakfast before the restaurant opens the next day, it will be served today from 8:00 PM. Are you sure?',
      () => {
        // Пользователь подтвердил — оставляем ланчбокс
        updateFormatOptions();
      },
      () => {
        // Пользователь отменил — переключаем на ресторан
        formatSelectEl.value = 'restaurant';
        formatSelectEl.dispatchEvent(new Event('change'));
      }
    );
    return;
  }

  // Обновление опций формата
  updateFormatOptions();

  function updateFormatOptions() {
    if (formatSelectEl.value === 'restaurant') {
      formatInfoEl.textContent = currentLanguage === 'ru'
        ? 'Ресторан находится рядом с основным ресепшеном. Отдельный вход налево от выхода.'
        : 'The restaurant is located next to the main reception. Separate entrance to the left.';
      timeSection.style.display = 'block';

      const restaurantTimes = ['9:30-10:00', '10:00-10:30', '10:30-11:00', '11:00-11:30'];
      restaurantTimes.forEach(time => {
        const option = document.createElement('option');
        option.value = time;
        option.textContent = time;
        timeSelect.appendChild(option);
      });

      updateTurkishBreakfastAvailability();
    } else if (formatSelectEl.value === 'lunchbox') {
      formatInfoEl.textContent = currentLanguage === 'ru'
        ? 'Ланчбокс нужно будет забрать вечером на ресепшене.'
        : 'The lunchbox should be picked up at the reception in the evening.';
      timeSection.style.display = 'block';

      const lunchboxTimes = ['20:00-20:30', '20:30-21:00', '21:00-21:30'];
      lunchboxTimes.forEach(time => {
        const option = document.createElement('option');
        option.value = time;
        option.textContent = time;
        timeSelect.appendChild(option);
      });

      updateTurkishBreakfastAvailability();
    } else {
      formatInfoEl.textContent = '';
      timeSection.style.display = 'none';
    }

    updateLunchboxAvailability(); // Обновляем доступность дат
  }
});
function resetFormAfterSubmit() {
  firstNameInput.value = ''; // Добавлено
  lastNameInput.value = ''; // Добавлено
  apartmentNumber.value = '';
  formatSelectEl.selectedIndex = 0;
  timeSelect.innerHTML = '';
  timeSection.style.display = 'none';
  formatInfoEl.textContent = '';
  guestsCount.selectedIndex = 0;
  guestsDetails.innerHTML = '';
  commentsField.value = '';
}


// Функция для экранирования HTML
function escapeHtml(text) {
  const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
  return text.replace(/[&<>"']/g, m => map[m]);
}

// Обработчик отправки формы
document.getElementById('breakfast-form').addEventListener('submit', function(event) {
  event.preventDefault();

  // Получаем данные из формы
  const firstName = firstNameInput.value.trim();
  const lastName = lastNameInput.value.trim();
  const apartment = apartmentNumber.value.trim();
  const format = formatSelectEl.options[formatSelectEl.selectedIndex].text;
  const dateOption = dateSelect.value;
  const time = timeSelect.options[timeSelect.selectedIndex]?.text || '';
  const guestsCountValue = guestsCount.value;
  const comments = commentsField.value.trim();

  // Проверка обязательных полей
  if (!firstName || !lastName || !apartment || !format || !dateOption || !time || !guestsCountValue) {
    showModal(currentLanguage === 'ru' ? 'Пожалуйста, заполните все обязательные поля.' : 'Please fill in all required fields.');
    return;
  }

  // Конвертация даты
  const today = new Date();
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);
  const dateValue = dateOption === 'today' ? formatDate(today) : formatDate(tomorrow);

  // Подсчет типов завтраков и формирование состава
  let heartyCount = 0;
  let sweetCount = 0;
  let assortedCount = 0;
  let turkishCount = 0;
  let orderSummary = `<strong>${currentLanguage === 'ru' ? 'Ваш заказ:' : 'Your order:'}</strong><br><br>`;
  let detailsForSheet = '';

  const guestOrders = [];
  const guestBlocks = guestsDetails.querySelectorAll('.form-section');
  guestBlocks.forEach((block, index) => {
    const breakfastSelect = block.querySelector(`select[name="guest${index + 1}-breakfast"]`);
    const breakfastValue = breakfastSelect.value;
    let breakfastText, breakfastTextFull;

    switch (breakfastValue) {
      case 'hearty':
        breakfastText = currentLanguage === 'ru' ? 'Сытный' : 'Hearty';
        breakfastTextFull = currentLanguage === 'ru' ? 'Сытный завтрак' : 'Hearty breakfast';
        heartyCount++;
        break;
      case 'sweet':
        breakfastText = currentLanguage === 'ru' ? 'Сладкий' : 'Sweet';
        breakfastTextFull = currentLanguage === 'ru' ? 'Сладкий завтрак' : 'Sweet breakfast';
        sweetCount++;
        break;
      case 'assorted':
        breakfastText = currentLanguage === 'ru' ? 'Ассорти' : 'Assorted';
        breakfastTextFull = currentLanguage === 'ru' ? 'Ассорти завтрак' : 'Assorted breakfast';
        assortedCount++;
        break;
      case 'turkish':
        breakfastText = currentLanguage === 'ru' ? 'Турецкий' : 'Turkish';
        breakfastTextFull = currentLanguage === 'ru' ? 'Турецкий завтрак' : 'Turkish breakfast';
        turkishCount++;
        break;
      default:
        breakfastText = '';
        breakfastTextFull = '';
    }

    let guestOrder = `${breakfastTextFull}`;
    let guestOrderForSheet = `${index + 1}. ${breakfastText}`;

    const porridge = block.querySelector(`select[name="guest${index + 1}-porridge"]`);
    if (porridge && porridge.value !== 'none') {
      const porridgeText = porridge.selectedOptions[0].textContent;
      guestOrder += `, ${porridgeText}`;
      guestOrderForSheet += `, ${porridgeText}`;
    }

    const drink = block.querySelector(`select[name="guest${index + 1}-drink"]`);
    if (drink) {
      const drinkText = drink.selectedOptions[0].textContent;
      guestOrder += `, ${drinkText}`;
      guestOrderForSheet += `, ${drinkText}`;
    }

    const dish = block.querySelector(`select[name="guest${index + 1}-dish"]`);
    if (dish) {
      const dishText = dish.selectedOptions[0].textContent;
      guestOrder += `, ${dishText}`;
      guestOrderForSheet += `, ${dishText}`;
    }

    const extras = block.querySelectorAll(`input[name="guest${index + 1}-extras"]:checked`);
    let extrasText = '';
    let extrasTextForSheet = '';
    if (extras.length > 0) {
      extrasText = Array.from(extras)
        .map(extra => {
          const label = extra.nextSibling.textContent.trim();
          return label.split(' – ')[0] + ' (доп.)';
        })
        .join(', ');
      extrasTextForSheet = Array.from(extras)
        .map(extra => {
          const label = extra.nextSibling.textContent.trim();
          return label.split(' – ')[0] + ' (доп.)';
        })
        .join(', ');
      guestOrder += `, ${extrasText}`;
      guestOrderForSheet += `, ${extrasTextForSheet}`;
    }

    if (comments) {
      guestOrder += `, Комментарий: ${escapeHtml(comments)}`;
      guestOrderForSheet += `, Комментарий: ${comments}`;
    }

    guestOrders.push(`<strong>${currentLanguage === 'ru' ? 'Гость' : 'Guest'} ${index + 1}:</strong> ${guestOrder}`);
    detailsForSheet += guestOrderForSheet + '\n';
  });

  // Формируем orderSummary для модального окна
  orderSummary += `<strong>${currentLanguage === 'ru' ? 'Имя' : 'Name'}:</strong> ${escapeHtml(firstName)} ${escapeHtml(lastName)}<br>`;
  orderSummary += `<strong>${currentLanguage === 'ru' ? 'Номер' : 'Apartment'}:</strong> ${escapeHtml(apartment)}<br>`;
  orderSummary += `<strong>${currentLanguage === 'ru' ? 'Дата и время заказа' : 'Date and time'}:</strong> ${dateValue}, ${time}<br>`;
  orderSummary += `<strong>${currentLanguage === 'ru' ? 'Формат подачи' : 'Serving format'}:</strong> ${format}<br><br>`;
  orderSummary += guestOrders.join('<br>');
  orderSummary += `<br><br><strong>${currentLanguage === 'ru' ? 'Подтвердить заказ?' : 'Confirm order?'}</strong>`;

  // Показываем модальное окно для подтверждения
  showConfirmModal(orderSummary, () => {
    // Отправка данных в Google Таблицу
    const data = {
      date: dateValue,
      time: time,
      apartment: apartment,
      guestCount: guestsCountValue,
      heartyCount: heartyCount,
      sweetCount: sweetCount,
      assortedCount: assortedCount,
      turkishCount: turkishCount,
      details: detailsForSheet.trim(),
      language: currentLanguage === 'ru' ? 'Русский' : 'English',
      fullName: `${firstName} ${lastName}`
    };

    fetch('https://script.google.com/macros/s/AKfycby9xxWLVRTHg16bgDTooOmB713vXWOMD4168wG8rzT2YF1AodEJW51_mwc3MENKds_T/exec', {
      method: 'POST',
      body: JSON.stringify(data),
      headers: { 'Content-Type': 'application/json' },
      mode: 'no-cors'
    })
    .then(() => {
      showModal(currentLanguage === 'ru' ? 'Спасибо! Ваш заказ отправлен!' : 'Thank you! Your order has been sent!', () => {
        resetFormAfterSubmit();
      });
    })
    .catch(error => {
      console.error('Ошибка:', error);
      showModal(currentLanguage === 'ru' ? 'Ошибка при отправке заказа.' : 'Error sending order.');
    });
  }, () => {
    // Ничего не делаем при отмене
  });
});

// Полный сброс формы
function resetFormAfterSubmit() {
  document.getElementById('breakfast-form').reset();
  guestsDetails.innerHTML = '';
  dateSection.style.display = 'none';
  timeSection.style.display = 'none';
  formatInfoEl.textContent = '';
}
</script>
</body>
</html>
